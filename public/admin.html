<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SeatSnag Admin - Two-Tier Management</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<link rel="stylesheet" href="../css/shared.css">
<link rel="stylesheet" href="../css/admin.css">

</head>
<body>
<div class="container">
  <!-- Login Screen -->
  <div id="loginScreen">
    <div class="login-screen">
      <div class="logo" style="margin: 0 auto 24px; width: 80px; height: 80px; font-size: 32px;">ğŸ¢</div>
      <h1 class="login-title">SeatSnag Admin</h1>
      <p class="login-subtitle">Secure access to your workspace management</p>
      
       <div class="login-form">
          <div class="form-group" style="text-align: left;">
            <label class="form-label">Admin Email</label>
            <input type="email" 
                  class="form-input" 
                  id="adminEmailInput" 
                  placeholder="admin@yourcompany.com" 
                  required 
                  autocomplete="email">
          </div>

          <div class="form-group" style="text-align: left;">
            <label class="form-label">Password</label>
              <div class="password-input-wrapper">
                <input type="password" 
                      class="form-input" 
                      id="adminPasswordInput" 
                      placeholder="Enter your password" 
                      required
                      autocomplete="current-password">
                <button type="button" 
                        class="password-toggle-btn" 
                        id="passwordToggleBtn"
                        onclick="togglePasswordVisibility()"
                        aria-label="Toggle password visibility">
                  <svg class="eye-icon" id="eyeIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                  <svg class="eye-icon-slash" id="eyeSlashIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                    <line x1="1" y1="1" x2="23" y2="23"></line>
                  </svg>
                </button>
              </div>
          </div>

          <button class="btn btn-primary login-btn" id="loginBtn">
            Admin Login
          </button>

          <div style="text-align: center; margin-top: 16px;">
            <a href="#"
               class="forgot-password-link"
               onclick="showForgotPasswordModal(); return false;">
              Forgot Password?
            </a>
          </div>
        </div>
      
      
    </div>
  </div>

  <!-- Main Dashboard -->
  <div id="mainDashboard" style="display: none;">
    <div class="header">
      <div class="title-section">
        <div class="logo">ğŸ¢</div>
        <div class="title-text">
          <h1>SeatSnag Admin</h1>
          <p id="dashboardSubtitle">Manage companies and workspace settings</p>
        </div>
      </div>
      <div class="user-info" id="userInfo" style="display: none;">
        <button class="upgrade-btn-header" id="upgradeBtnHeader" onclick="goToUpgrade()" style="display: none;">
          âœ¨ Upgrade Plan
        </button>
        <div class="user-avatar" id="userAvatar">SA</div>
        <div class="user-details">
          <h3 id="userName">Super Admin</h3>
          <p id="userRole">Full Access</p>
        </div>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
    </div>
    
    <!-- Trial Status Banner -->
    <div id="trialBanner" class="trial-banner" style="display: none;">
      <div class="banner-content">
        <span id="bannerIcon">â°</span>
        <span id="bannerMessage">Trial status</span>
        <button id="upgradeBtn" class="upgrade-btn">Upgrade Now</button>
      </div>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <span class="stat-icon">ğŸ¢</span>
        <div class="stat-number" id="totalCompanies">-</div>
        <div class="stat-label">Total Companies</div>
      </div>
      <div class="stat-card">
        <span class="stat-icon">ğŸ“</span>
        <div class="stat-number" id="totalLocations">-</div>
        <div class="stat-label">Total Locations</div>
      </div>
      <div class="stat-card">
        <span class="stat-icon">ğŸ’º</span>
        <div class="stat-number" id="totalSeats">-</div>
        <div class="stat-label">Total Seats</div>
      </div>
      <div class="stat-card">
        <span class="stat-icon">ğŸ“Š</span>
        <div class="stat-number" id="activeBookings">-</div>
        <div class="stat-label">Active Bookings</div>
      </div>
    </div>

    <!-- Analytics Dashboard -->
    <div class="analytics-section" id="analyticsSection" style="display: none;">
      <div class="section-header">
        <h2 class="section-header-title">
          <span>ğŸ“ˆ</span>
          <span>Analytics Dashboard</span>
        </h2>
        <div class="period-selector">
          <button class="period-btn active" data-period="1w" onclick="switchAnalyticsPeriod('1w')">Last 7 Days</button>
          <button class="period-btn" data-period="1m" onclick="switchAnalyticsPeriod('1m')">Last 30 Days</button>
          <button class="period-btn" data-period="3m" onclick="switchAnalyticsPeriod('3m')">Last 90 Days</button>
          <button class="period-btn" data-period="1y" onclick="switchAnalyticsPeriod('1y')">Last Year</button>
        </div>
      </div>

      <!-- Utilization Trend Chart (Full Width) -->
      <div class="analytics-card trend-card">
        <h3 class="analytics-card-title">ğŸ“Š Utilization Trend</h3>
        <div class="trend-summary">
          <div class="trend-stat">
            <span class="trend-stat-label">Average Utilization</span>
            <span class="trend-stat-value" id="avgUtilization">-</span>
          </div>
          <div class="trend-stat">
            <span class="trend-stat-label">Total Bookings</span>
            <span class="trend-stat-value" id="totalBookings">-</span>
          </div>
          <div class="trend-stat">
            <span class="trend-stat-label">Peak Day</span>
            <span class="trend-stat-value" id="peakDay">-</span>
          </div>
        </div>
        <div class="chart-container">
          <div id="trendChart" class="trend-chart"></div>
          <div id="trendChartLoading" class="chart-loading">Loading analytics...</div>
        </div>
      </div>

      <!-- Two Column Grid: Location Performance + Heatmap -->
      <div class="analytics-grid">
        <!-- Location Performance -->
        <div class="analytics-card">
          <h3 class="analytics-card-title">ğŸ¢ Location Performance</h3>
          <div id="locationPerformance" class="location-performance"></div>
          <div id="locationPerformanceLoading" class="chart-loading">Loading...</div>
        </div>

        <!-- Weekly Heatmap -->
        <div class="analytics-card">
          <h3 class="analytics-card-title">ğŸ—“ï¸ Weekly Pattern</h3>
          <div id="weeklyHeatmap" class="weekly-heatmap"></div>
          <div id="heatmapLoading" class="chart-loading">Loading...</div>
          <div class="heatmap-legend">
            <div class="legend-item"><div class="legend-color" style="background: #22c55e;"></div><span>0-40%</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #eab308;"></div><span>40-70%</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #f97316;"></div><span>70-85%</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #ef4444;"></div><span>85%+</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Super Admin: Company Creation -->
    <div class="section" data-icon="âœ¨" id="superAdminSection" style="display: none;">
      <h2 class="section-title">
        <svg width="32" height="32" viewBox="0 0 160 160" xmlns="http://www.w3.org/2000/svg" id="seatSnagLogoAdmin">
          <defs>
            <linearGradient id="seatGradientAdmin" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#4F46E5" />
              <stop offset="100%" stop-color="#4338CA" />
            </linearGradient>
          </defs>
          <path class="seat-path-orange" d="M 110,45 C 50,45 50,90 90,90 C 130,90 130,135 70,135" fill="none" stroke="#fbbf24" stroke-width="4" stroke-linecap="round" />
          <path class="seat-path-gradient" d="M 110,45 C 50,45 50,90 90,90 C 130,90 130,135 70,135" fill="none" stroke="url(#seatGradientAdmin)" stroke-width="4" stroke-linecap="round" />
          <path class="seat-path-glisten" d="M 110,45 C 50,45 50,90 90,90 C 130,90 130,135 70,135" fill="none" stroke="#ffffff" stroke-width="4" stroke-linecap="round" />
          <circle id="dot1" class="dot" cx="110" cy="45" r="4" fill="#4F46E5" />
          <circle id="dot2" class="dot" cx="70" cy="135" r="4" fill="#4338CA" />
        </svg>
        Add New Company
      </h2>
      <p class="section-subtitle">
        Create a new company with admin credentials. The company admin will manage all locations.
      </p>
      
      <div class="success-feedback" id="companySuccess"></div>
      <div class="error-feedback" id="companyError"></div>
      
      <div class="company-form-grid">
        <div class="input-group">
          <label class="input-label">Company Name</label>
          <input type="text" class="form-input" id="companyName" placeholder="e.g. Tech Corp">
        </div>
        <div class="input-group">
          <label class="input-label">Company Code</label>
          <input type="text" class="form-input" id="companyCode" placeholder="e.g. TECH" maxlength="10" style="text-transform: uppercase;">
        </div>
        <div class="input-group">
          <label class="input-label">Admin First Name</label>
          <input type="text" class="form-input" id="adminFirstName" placeholder="e.g. Sarah">
        </div>
        <div class="input-group">
          <label class="input-label">Admin Last Name</label>
          <input type="text" class="form-input" id="adminLastName" placeholder="e.g. Wilson">
        </div>
        <div class="input-group">
          <label class="input-label">Secret PIN</label>
          <input type="text" class="form-input" id="secretPin" placeholder="4-digit PIN" maxlength="4">
        </div>
        <div class="input-group">
          <label class="input-label">Admin Email</label>
          <input type="email" class="form-input" id="adminEmail" placeholder="sarah@techcorp.com">
        </div>
      </div>
      
      <button class="add-btn" onclick="addCompany()">
        Create Company
      </button>
    </div>

    <!-- Super Admin: Recent Signups -->
    <div class="section" data-icon="ğŸ“¢" id="recentSignupsSection" style="display: none;">
      <h2 class="section-title">
        <span>ğŸ“ˆ</span>
        Recent Signups
      </h2>
      <p class="section-subtitle">
        Companies that signed up through the signup form in the last 7 days
      </p>
      
      <div class="recent-signups-grid" id="recentSignupsList">
        <div class="loading">Loading recent signups...</div>
      </div>
    </div>


    <!-- Add Location --> 
     <div class="section" data-icon="ğŸ“" id="companyAdminSection" style="display: none;">
        <h2 class="section-title">
          <span>ğŸ¢</span>
          Add New Location
        </h2>
        <p class="section-subtitle">
          Add office locations where your employees can book seats
        </p>
        
        <div class="success-feedback" id="locationSuccess"></div>
        <div class="error-feedback" id="locationError"></div>
        
        <div style="display: grid; grid-template-columns: 1.2fr 1.2fr 1fr; gap: 16px; align-items: start; margin-bottom: 20px;">
          
          <div class="input-group">
            <label class="input-label">Location Name</label>
            <input type="text" class="form-input" id="locationName" placeholder="e.g. HQ San Francisco">
          </div>
          
          <div class="input-group">
            <label class="input-label">Address</label>
            <input type="text" class="form-input" id="locationAddress" placeholder="123 Main St, SF">
          </div>
          
          <div class="input-group">
            <label class="input-label">Access Code</label>
            <div style="display: flex; gap: 8px; align-items: stretch;">
              <input type="text" 
                     class="form-input" 
                     id="locationAccessCode" 
                     placeholder="e.g. SF24HQ" 
                     maxlength="8"
                     style="text-transform: uppercase; flex: 1; margin: 0;">
              <button type="button"
                      style="background: #667eea; color: white; padding: 10px 20px; white-space: nowrap; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; border: none;"
                      onclick="generateAndDisplayCode()"
                      onmouseover="this.style.background='#5568d3'"
                      onmouseout="this.style.background='#667eea'">
                ğŸ”„ Generate
              </button>
            </div>
            <small style="color: #64748b; font-size: 0.85em; margin-top: 4px; display: block;">
              ğŸ“‹ Employees will use this code to access booking (6-8 characters)
            </small>
          </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; align-items: start; margin-bottom: 30px;">

          <div class="input-group">
            <label class="input-label">Employee PIN (Optional)</label>
            <input type="text" class="form-input" id="locationPin" placeholder="Legacy 4-digit PIN" maxlength="4">
            <small style="color: #94a3b8; font-size: 0.85em; margin-top: 4px; display: block;">
              âš ï¸ Optional - For backward compatibility only
            </small>
          </div>

          <div class="input-group">
            <label class="input-label">Daily Capacity</label>
            <input type="number" class="form-input" id="locationCapacity" placeholder="e.g. 50" min="1" max="500">
          </div>

          <div class="input-group">
            <label class="input-label">Monthly Rental ($)</label>
            <input type="number" class="form-input" id="locationMonthlyRental" placeholder="e.g. 5000" min="0" step="100">
            <small style="color: #64748b; font-size: 0.85em; margin-top: 4px; display: block;">
              ğŸ’° Used for cost analytics
            </small>
          </div>
        </div>
        
        <button class="add-btn" onclick="addLocation()">
          Add Location
        </button>
      </div>

    
    <!-- Companies List -->
    <div class="companies-section">
      <div class="section-header">
        <h2 class="section-header-title">
          <span>ğŸ“‹</span>
          <span id="companiesTitle">Company Directory</span>
        </h2>
        <input type="text" class="filter-input" placeholder="Search..." id="searchFilter" onkeyup="filterResults()">
      </div>
      
      <div class="companies-grid" id="dataList">
        <div class="loading">Loading...</div>
      </div>
    </div>
  </div>
</div>

<!-- Forgot Password Modal -->
<div id="forgotPasswordModal" class="modal-overlay" style="display: none;" onclick="closeForgotPasswordModal()">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div class="modal-header">
      <h2>Reset Password</h2>
      <button class="modal-close" onclick="closeForgotPasswordModal()">&times;</button>
    </div>
    <div class="modal-body">
      <p style="color: #64748b; margin-bottom: 20px;">
        Enter your email address and we'll send you a link to reset your password.
      </p>
      <div class="form-group">
        <label class="form-label">Email Address</label>
        <input type="email"
               class="form-input"
               id="resetEmailInput"
               placeholder="admin@yourcompany.com"
               autocomplete="email">
      </div>
      <div id="resetMessage" style="display: none; margin-bottom: 16px;"></div>
      <button class="btn btn-primary" id="sendResetBtn" onclick="handlePasswordReset()">
        Send Reset Link
      </button>
    </div>
  </div>
</div>

<!-- Firebase SDKs -->
<script type="module" src="../js/admin.js"></script>
</body>
</html>